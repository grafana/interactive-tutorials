# Manifest Reference

This document is the field reference for `manifest.json` files in the `interactive-tutorials` repository. It covers the package directory structure, every manifest field, and the rules for deriving field values during migration from the existing `content.json` + `index.json` model.

**Authoritative schema source:** The canonical JSON Schema for manifests is generated by the Pathfinder CLI:

```bash
node dist/cli/cli/index.js schema manifest
```

Run this from a [grafana-pathfinder-app](https://github.com/grafana/grafana-pathfinder-app) checkout to get the latest schema. This document is a practical companion to that schema, not a replacement.

**Upstream design docs:**

- [PATHFINDER-PACKAGE-DESIGN.md](https://github.com/grafana/grafana-pathfinder-app/blob/main/docs/design/PATHFINDER-PACKAGE-DESIGN.md) — package format spec
- [package-authoring.md](https://github.com/grafana/grafana-pathfinder-app/blob/main/docs/developer/package-authoring.md) — manifest field reference and templates
- [CLI_TOOLS.md](https://github.com/grafana/grafana-pathfinder-app/blob/main/docs/developer/CLI_TOOLS.md) — `validate --package`, `build-repository`, `build-graph`, `schema manifest`

---

## Package directory structure

A **package** is a directory containing both `content.json` (the guide) and `manifest.json` (metadata, targeting, dependencies).

### Standalone guide

```
alerting-101/
├── content.json       # Guide content (existing)
└── manifest.json      # Package manifest (new)
```

### Learning path

A learning path (`*-lj` directory) is a package of type `"path"` with child step packages:

```
prometheus-lj/
├── content.json       # Path-level cover page (new, created during migration)
├── manifest.json      # type: "path", steps array (new)
├── add-data-source/
│   ├── content.json   # Step guide (existing)
│   └── manifest.json  # type: "guide" (new)
├── verify-ds-connection/
│   ├── content.json
│   └── manifest.json
└── ...
```

---

## Field reference

### All fields

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `id` | `string` | **Yes** | — | Unique package identifier. Must match the `id` in `content.json`. |
| `type` | `"guide"` \| `"path"` | **Yes** | — | `"guide"` for standalone guides and LJ steps; `"path"` for `*-lj` root directories. |
| `repository` | `string` | No | `"interactive-tutorials"` | Repository identifier. Can be omitted (schema default applies). |
| `description` | `string` | **Yes** | — | Short description of the guide or path. |
| `category` | `string` | No | `"general"` | Content category for grouping and filtering. |
| `author` | `object` | **Yes** | — | Attribution. See [author](#author). |
| `language` | `string` | No | `"en"` | BCP 47 language tag. Can be omitted (schema default applies). |
| `startingLocation` | `string` | No | `"/"` | URL path where the guide should be launched. |
| `targeting` | `object` | No | — | Contextual recommendation rules. See [targeting](#targeting). |
| `testEnvironment` | `object` | No | — | Where to test this guide. See [testEnvironment](#testenvironment). |
| `depends` | `string[]` | No | `[]` | Package IDs this package requires to have been completed first. |
| `recommends` | `string[]` | No | `[]` | Package IDs suggested as follow-ups. |
| `suggests` | `string[]` | No | `[]` | Loosely related package IDs. |
| `provides` | `string[]` | No | `[]` | Capability tokens this package provides (e.g., `"datasource-configured"`). |
| `steps` | `string[]` | **Yes** (paths only) | — | Ordered list of step package IDs. Only for `type: "path"`. |

### author

```json
{
  "team": "interactive-learning"
}
```

All content in this repository is authored by the same team. Use this value for all manifests.

### targeting

The `targeting` object contains a `match` expression that determines when the guide is contextually recommended. The `match` value uses the same expression syntax as `index.json` rules.

```json
{
  "targeting": {
    "match": {
      "or": [
        { "urlPrefix": "/alerting" },
        { "urlPrefixIn": ["/alerts-and-incidents"] }
      ]
    }
  }
}
```

**Leaf predicates:**

| Predicate | Example | Meaning |
|-----------|---------|---------|
| `urlPrefix` | `"/alerting"` | Current URL path starts with value |
| `urlPrefixIn` | `["/alerting", "/alerts"]` | Current URL path starts with any value |
| `source` | `"play.grafana.org"` | Request origin matches (regex) |
| `targetPlatform` | `"cloud"` | Grafana deployment type |

**Combinators:** `and` (all must match), `or` (any must match). Can be nested.

### testEnvironment

Describes where CI or manual testing should run.

| Field | Type | Description |
|-------|------|-------------|
| `tier` | `"local"` \| `"cloud"` \| `"play"` | Environment tier. |
| `instance` | `string` | Specific instance URL (e.g., `"play.grafana.org"`). Only when `tier` is not `"local"`. |

**Tier inference rules:**

| Condition | Tier |
|-----------|------|
| `match` contains a `source` rule at any depth | `"cloud"` (and set `instance` to the `source` value) |
| `match` contains `"targetPlatform": "cloud"` (without `source`) | `"cloud"` |
| `match` contains `source: "play.grafana.org"` | `"play"` (with `instance: "play.grafana.org"`) |
| Otherwise | `"local"` |

---

## Field derivation rules

These rules define where each manifest field's data comes from during migration. The principle is **maximally complete from existing data, no guessing or inventing**.

### For standalone guides

| Field | Source | Derivation |
|-------|--------|------------|
| `id` | `content.json` | Copy the `id` field verbatim. |
| `type` | — | Always `"guide"`. |
| `repository` | — | Omit (schema default `"interactive-tutorials"` applies). |
| `description` | `index.json` rule | Copy the `description` from the matching rule. |
| `category` | Website markdown | Use `journey.group` from the parent learning path's `_index.md` if the guide belongs to one; otherwise `"general"`. |
| `author` | — | `{ "team": "interactive-learning" }` |
| `language` | — | Omit (schema default `"en"` applies). |
| `startingLocation` | `index.json` rule | Recursively traverse the `match` expression and pick the first URL-bearing leaf (`urlPrefix` value or first entry of `urlPrefixIn`). Falls back to `"/"` if no URL rule exists. |
| `targeting.match` | `index.json` rule | Copy the `match` object verbatim. |
| `testEnvironment.tier` | `index.json` rule | Apply [tier inference rules](#testenvironment). |
| `testEnvironment.instance` | `index.json` rule | Set to the `source` value if present; otherwise omit. |
| `depends` | — | Leave empty unless explicitly known. |
| `recommends` | — | Leave empty unless explicitly known. |
| `suggests` | — | Leave empty unless explicitly known. |
| `provides` | Guide semantics | Infer from what the guide accomplishes. Leave empty when not obvious. |

### For learning path steps

| Field | Source | Derivation |
|-------|--------|------------|
| `id` | `content.json` | Copy the `id` field verbatim. |
| `type` | — | Always `"guide"`. |
| `description` | Website step `index.md` | From the step markdown's `description` frontmatter field. |
| `category` | Website path `_index.md` | Use `journey.group` from the parent path's `_index.md`. |
| `author` | — | `{ "team": "interactive-learning" }` |
| `targeting` | — | Omit unless the step has its own `index.json` entry (targeting lives at the path level). |
| `depends` | Step ordering | Step N+1 depends on step N. First step has no `depends`. |
| `recommends` | Step ordering + `side_journeys` | Step N recommends step N+1. Also include `side_journeys` from step markdown. Last step has no next-step recommendation. |
| `suggests` | Step `index.md` | From `side_journeys` in step markdown. |

### For learning paths (type: "path")

| Field | Source | Derivation |
|-------|--------|------------|
| `id` | Directory name | The `*-lj` directory name (e.g., `"prometheus-lj"`). |
| `type` | — | Always `"path"`. |
| `description` | Website `_index.md` | From the path-level `_index.md` frontmatter `description` field. |
| `category` | Website `_index.md` | From `journey.group` (e.g., `"data-availability"`). |
| `author` | — | `{ "team": "interactive-learning" }` |
| `startingLocation` | `index.json` rule | Same derivation as standalone guides. Falls back to `"/"`. |
| `targeting.match` | `index.json` rule | Copy the `match` object from the matching rule, if one exists. |
| `testEnvironment` | `index.json` rule | Apply [tier inference rules](#testenvironment). |
| `steps` | Website step markdown | Ordered list of step package IDs, derived from the step markdown `weight` field ordering. The `pathfinder_data` frontmatter maps each step to its `interactive-tutorials` directory. |
| `recommends` | Website `_index.md` | From `journey.links.to`. |
| `suggests` | Website `_index.md` | From `related_journeys`. |
| `depends` | Website `_index.md` | From `related_journeys` where relationship is prerequisite. |

---

## Matching index.json rules to guides

The `index.json` `url` field contains the CDN URL for the guide, e.g.:

```
https://interactive-learning.grafana.net/guides/alerting-101
https://interactive-learning.grafana.net/guides/connect-metrics-data/content.json
```

To match a rule to a guide directory:

1. Strip any trailing `/content.json` from the URL.
2. Extract the last path segment (e.g., `alerting-101`).
3. Compare against the guide's directory name or `content.json` `id`.

For learning path steps, individual steps typically don't have their own `index.json` entries. Targeting lives at the path level. Step-level manifests omit the `targeting` field unless the step has its own `index.json` rule.

---

## Translating index.json rules to targeting.match

Copy the `match` object from the `index.json` rule directly into `targeting.match`. The expression syntax is identical.

**Example — index.json rule:**

```json
{
  "title": "Interactive Guide: Alerting 101",
  "url": "https://interactive-learning.grafana.net/guides/alerting-101",
  "description": "Hands-on guide: Learn how to create and test alerts in Grafana.",
  "type": "interactive",
  "match": {
    "or": [{ "urlPrefixIn": ["/alerting", "/alerts-and-incidents"] }]
  }
}
```

**Resulting manifest targeting:**

```json
{
  "targeting": {
    "match": {
      "or": [{ "urlPrefixIn": ["/alerting", "/alerts-and-incidents"] }]
    }
  }
}
```

---

## Naming conventions

| interactive-tutorials | website learning-paths |
|----------------------|----------------------|
| `prometheus-lj` | `prometheus` |
| `linux-server-integration-lj` | `linux-server-integration` |
| `drilldown-logs-lj` | `drilldown-logs` |
| Pattern: strip `-lj` suffix | |

Within paths, step directory names are identical in both repos. The website markdown `pathfinder_data` frontmatter provides the authoritative mapping (e.g., `pathfinder_data: prometheus-lj/add-data-source`).

Website learning path markdown location: `/Users/davidallen/hax/website/content/docs/learning-paths/`

---

## Templates

### Standalone guide manifest

```json
{
  "id": "<guide-id>",
  "type": "guide",
  "description": "<from index.json rule description>",
  "category": "<from journey.group or 'general'>",
  "author": { "team": "interactive-learning" },
  "startingLocation": "<first URL from match expression>",
  "targeting": {
    "match": { "<copied from index.json rule match>" : [] }
  },
  "testEnvironment": {
    "tier": "<local|cloud|play>"
  }
}
```

### Learning path manifest (type: "path")

```json
{
  "id": "<path-lj>",
  "type": "path",
  "description": "<from _index.md description>",
  "category": "<from journey.group>",
  "author": { "team": "interactive-learning" },
  "startingLocation": "<first URL from match expression or '/'>",
  "targeting": {
    "match": { "<copied from index.json rule match>" : [] }
  },
  "testEnvironment": {
    "tier": "<local|cloud>"
  },
  "steps": [
    "<step-1-id>",
    "<step-2-id>",
    "<step-3-id>"
  ],
  "recommends": ["<from journey.links.to>"],
  "suggests": ["<from related_journeys>"]
}
```

### Learning path step manifest

```json
{
  "id": "<step-id>",
  "type": "guide",
  "description": "<from step index.md description>",
  "category": "<from parent path journey.group>",
  "author": { "team": "interactive-learning" },
  "depends": ["<previous-step-id>"],
  "recommends": ["<next-step-id>"]
}
```

---

## Validation

Validate individual packages:

```bash
node dist/cli/cli/index.js validate --package <directory>
```

Validate all packages in the repo:

```bash
node dist/cli/cli/index.js validate --packages .
```

Build `repository.json` from all packages:

```bash
node dist/cli/cli/index.js build-repository . -o repository.json
```

These commands are run from a [grafana-pathfinder-app](https://github.com/grafana/grafana-pathfinder-app) checkout. CI runs them automatically; see `.github/workflows/validate-json.yml`.
