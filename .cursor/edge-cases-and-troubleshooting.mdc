---
description: Edge cases, troubleshooting patterns, and debugging techniques for interactive guides including DOM timing, permission issues, selector reliability, and browser compatibility.
---

# Edge Cases and Troubleshooting for AI

## Common Edge Cases

### DOM Timing Issues

#### Problem: Element Not Found
**Cause**: Interactive action executes before DOM element is rendered
**Solution**: Include appropriate requirements and verification

```json
// Bad: No existence check
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Save dashboard",
  "content": "Save dashboard"
}

// Good: Includes existence check
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Save dashboard",
  "requirements": ["on-page:/dashboard/edit"],
  "content": "Save dashboard"
}
```

#### Problem: Navigation Menu Not Open
**Cause**: Trying to interact with navigation elements when menu is closed
**Solution**: Always include `navmenu-open` requirement for nav interactions

```json
// Bad: Navigation element without menu requirement
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "a[href='/connections']",
  "content": "Click Connections"
}

// Good: Includes navigation requirement
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "a[href='/connections']",
  "requirements": ["navmenu-open"],
  "content": "Click Connections"
}
```

### Permission and Access Issues

#### Problem: Admin Actions for Non-Admin Users
**Cause**: Guide requires admin permissions but user doesn't have them
**Solution**: Make admin steps skippable or provide alternative paths

```json
// Option 1: Make skippable
{
  "type": "interactive",
  "action": "navigate",
  "reftarget": "/admin/plugins",
  "requirements": ["is-admin"],
  "skippable": true,
  "tooltip": "Admin access required - skip if you don't have permissions",
  "content": "Access plugin management (admin only)"
}

// Option 2: Provide alternative
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "div[data-testid='plugin-catalog']",
  "requirements": ["has-role:viewer"],
  "doIt": false,
  "tooltip": "You can browse plugins here, but installation requires admin privileges. Contact your administrator to request plugin installations.",
  "content": "Browse available plugins (view-only)"
}
```

#### Problem: Data Source Dependencies
**Cause**: Guide assumes specific data source exists
**Solution**: Use objectives for auto-completion or include setup sections

```json
// Option 1: Auto-complete if exists
{
  "type": "section",
  "id": "setup-prometheus",
  "title": "Setup Prometheus",
  "objectives": ["has-datasource:type:prometheus"],
  "tooltip": "Skips if Prometheus already configured",
  "blocks": [
    // Setup steps only run if Prometheus not configured
  ]
}

// Option 2: Check before dependent actions
{
  "type": "interactive",
  "action": "formfill",
  "reftarget": "textarea[data-testid='query-editor']",
  "targetvalue": "up",
  "requirements": ["has-datasource:prometheus"],
  "content": "Enter Prometheus query"
}
```

### Form Interaction Issues

#### Problem: React Controlled Inputs
**Cause**: React controlled inputs don't update with simple value assignment
**Solution**: System handles this automatically, but verify with `verify`

```json
// Good: Includes verification
{
  "type": "interactive",
  "action": "formfill",
  "reftarget": "input[data-testid='dashboard-title']",
  "targetvalue": "My Dashboard",

  "verify": "has-dashboard-named:My Dashboard",
  "content": "Set dashboard title"
}
```

#### Problem: ARIA Combobox Complexity
**Cause**: ARIA comboboxes require special tokenization and event handling
**Solution**: Use formfill action - system handles tokenization automatically

```json
// Complex query tokenization handled automatically
{
  "type": "interactive",
  "action": "formfill",
  "reftarget": "input[role='combobox'][aria-autocomplete='list']",
  "targetvalue": "job=\"prometheus\" level=\"error\"",
  "requirements": ["on-page:/explore"],
  "content": "Filter logs by job and level"
}
```

#### Problem: Monaco Editor Special Handling
**Cause**: Monaco editors need special event handling for React integration
**Solution**: System detects Monaco editors automatically

```json
// Monaco editor automatically detected by CSS classes
{
  "type": "interactive",
  "action": "formfill",
  "reftarget": "textarea.inputarea.monaco-mouse-cursor-text",
  "targetvalue": "rate(http_requests_total[5m])",

  "content": "Enter PromQL query"
}
```

### Navigation and Routing Issues

#### Problem: SPA Navigation Timing
**Cause**: Navigation completes but target page content not yet loaded
**Solution**: Use verification to confirm page content is ready

```json
// Good: Verifies navigation completed
{
  "type": "interactive",
  "action": "navigate",
  "reftarget": "/dashboard/new",
  "requirements": ["has-datasources"],
  "verify": "on-page:/dashboard/new,exists-reftarget",
  "content": "Navigate to create dashboard"
}

// Follow-up action waits for page content
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Add visualization",
  "requirements": ["on-page:/dashboard/new"],
  "content": "Add your first panel"
}
```

#### Problem: External URL Handling
**Cause**: External URLs might be blocked by browser security
**Solution**: Use navigate action - system opens in new tab safely

```json
// External URLs handled automatically
{
  "type": "interactive",
  "action": "navigate",
  "reftarget": "https://grafana.com/docs/",
  "tooltip": "Opens documentation in new tab",
  "content": "View Grafana documentation"
}
```

## Troubleshooting Patterns

### Debugging Failed Requirements

#### Network/API Issues
```json
// Include fallback for network failures
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Test connection",

  "skippable": true,
  "tooltip": "Skip if network connectivity issues",
  "content": "Test data source connection (skip if network issues)"
}
```

#### Plugin Availability Issues
```json
// Handle missing plugins gracefully
{
  "type": "interactive",
  "action": "navigate",
  "reftarget": "/a/custom-plugin/",
  "requirements": ["has-plugin:custom-plugin"],
  "skippable": true,
  "tooltip": "Requires custom plugin - skip if not installed",
  "content": "Use custom plugin features"
}

// Alternative without plugin
{
  "type": "interactive",
  "action": "navigate",
  "reftarget": "/dashboards",
  "tooltip": "Standard dashboards work without additional plugins",
  "content": "Use standard Grafana dashboards instead"
}
```

### Selector Reliability Issues

#### Problem: Element Selector Changes
**Cause**: Grafana UI updates change DOM structure or attributes
**Solution**: Use multiple fallback selectors and stable attributes

```json
// Primary selector with fallbacks
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Save dashboard",

  "content": "Save dashboard"
}

// If button text changes, use attribute selector
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "button[data-testid='save-dashboard']",

  "content": "Save dashboard using stable selector"
}
```

#### Problem: Multiple Element Matches
**Cause**: Selector matches multiple elements when only one intended
**Solution**: Use more specific selectors or pseudo-selectors

```json
// Bad: Might match multiple panels
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "div[data-testid='panel']",
  "content": "Edit panel"
}

// Good: Targets specific panel
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "div[data-testid='panel']:first-of-type",
  "content": "Edit the first panel"
}

// Better: Use unique identifier if available
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "div[data-panel-id='panel-1']",
  "content": "Edit panel 1"
}
```

### Sequential Flow Issues

#### Problem: Steps Out of Order
**Cause**: User completes steps manually outside guide flow
**Solution**: Use objectives to handle already-completed states

```json
// Auto-complete if already done
{
  "type": "interactive",
  "action": "formfill",
  "reftarget": "input[id='datasource-name']",
  "targetvalue": "prometheus",
  "objectives": ["has-datasource:prometheus"],

  "content": "Name your data source"
}
```

#### Problem: Section Dependencies
**Cause**: User tries to do section 2 before completing section 1
**Solution**: Use section-completed requirements

```json
{
  "type": "section",
  "id": "section-2",
  "title": "Section 2",
  "requirements": ["section-completed:section-1"],
  "tooltip": "Complete the previous section first",
  "blocks": [
    // Section 2 content
  ]
}
```

### Performance and Scalability Issues

#### Problem: Too Many Requirements Checks
**Cause**: Complex requirements causing performance issues
**Solution**: Group related requirements and use caching

```json
// Good: Grouped related requirements
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Create dashboard",
  "requirements": ["has-datasources", "has-role:editor", "on-page:/dashboards"],
  "tooltip": "Groups related checks efficiently",
  "content": "Create new dashboard"
}

// Bad: Separate similar checks
// Step 1
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Create dashboard",
  "requirements": ["has-datasource:prometheus"],
  "content": "Step 1"
}
// Step 2 (redundant check)
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Save dashboard",
  "requirements": ["has-datasource:prometheus"],
  "content": "Step 2"
}
```

#### Problem: Expensive State Checks
**Cause**: Requirements that make expensive API calls
**Solution**: Use objectives for expensive checks that auto-complete

```json
// Use objective for expensive dashboard search
{
  "type": "section",
  "id": "create-dashboard",
  "title": "Create Dashboard",
  "objectives": ["has-dashboard-named:Monitoring Dashboard"],
  "tooltip": "Skips creation if dashboard already exists",
  "blocks": [
    // Creation steps
  ]
}
```

## Error Recovery Strategies

### Graceful Degradation Patterns

#### Network Connectivity Issues
```json
// Primary action with network dependency
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Test connection",

  "skippable": true,
  "tooltip": "Skip if experiencing network connectivity issues",
  "content": "Test data source connection"
}

// Offline alternative
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "div[data-testid='connection-status']",
  "doIt": false,
  "tooltip": "If connection testing fails, check your network connectivity and firewall settings. You can still configure the data source and test the connection later.",
  "content": "Review connection status information"
}
```

#### Missing Feature Fallbacks
```json
// Modern feature with fallback
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Use query library",
  "requirements": ["has-feature:queryLibrary"],
  "skippable": true,
  "tooltip": "Query library feature - skip if not available",
  "content": "Use query library (if available)"
}

// Traditional approach
{
  "type": "interactive",
  "action": "formfill",
  "reftarget": "textarea[data-testid='query-editor']",
  "targetvalue": "rate(http_requests_total[5m])",

  "content": "Or enter query manually in editor"
}
```

### Error Message Patterns

#### Helpful Error Messages
```json
// Clear explanation with context
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Create alert",
  "requirements": ["has-datasource:prometheus", "has-permission:alerting:write"],
  "tooltip": "Requires Prometheus data source and alerting permissions to create alert rules",
  "content": "Create monitoring alert"
}

// Specific guidance for resolution
{
  "type": "interactive",
  "action": "navigate",
  "reftarget": "/admin/plugins",
  "requirements": ["is-admin"],
  "skippable": true,
  "tooltip": "Plugin management requires admin role - contact your administrator if you need plugin access",
  "content": "Manage plugins (admin required)"
}
```

#### Progressive Error Handling
```json
// Try automatic fix first
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "a[href='/connections']",
  "requirements": ["navmenu-open"],
  "content": "Click Connections in navigation"
}

// Manual alternative if auto-fix fails
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "#mega-menu-toggle",

  "tooltip": "If the navigation menu didn't open automatically, click the menu toggle button to open it manually.",
  "content": "Manually open navigation menu if needed"
}
```

## Browser and Environment Issues

### Cross-Browser Compatibility

#### Safari-Specific Issues
```json
// Safari has different button text handling
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Save",

  "tooltip": "Uses exact text matching for cross-browser compatibility",
  "content": "Save changes"
}

// Fallback with selector
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "button[data-testid='save-button']",

  "content": "Save using attribute selector"
}
```

#### Mobile and Tablet Considerations
```json
// Touch-friendly interactions
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "button[data-testid='mobile-menu']",

  "tooltip": "Mobile navigation might use different menu structure",
  "content": "Access mobile navigation menu"
}
```

### Theme and Styling Issues

#### Dark vs Light Theme
```json
// Theme-agnostic selectors
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "button[data-testid='theme-toggle']",

  "doIt": false,
  "tooltip": "The theme toggle switches between light and dark modes. All interactive guides work in both themes using stable selectors that don't depend on theme-specific styling.",
  "content": "Notice the theme toggle option"
}
```

## Version Compatibility Issues

### Grafana Version Differences

#### Version-Specific Features
```json
// Modern Grafana features
{
  "type": "interactive",
  "action": "button",
  "reftarget": "New scene",
  "requirements": ["min-version:9.0.0"],
  "skippable": true,
  "tooltip": "Scenes feature requires Grafana 9.0+",
  "content": "Use new scenes feature"
}

// Fallback for older versions
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Create dashboard",

  "content": "Create dashboard using standard interface"
}
```

#### API Compatibility
```json
// Check for API availability
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Query library",
  "requirements": ["has-feature:queryLibrary", "min-version:8.5.0"],
  "skippable": true,
  "tooltip": "Query library requires specific Grafana version and feature toggle",
  "content": "Access query library"
}
```

### Plugin Compatibility
```json
// Plugin version dependencies
{
  "type": "interactive",
  "action": "navigate",
  "reftarget": "/a/plugin-app/",
  "requirements": ["has-plugin:plugin-id", "min-version:9.0.0"],
  "skippable": true,
  "tooltip": "Plugin requires compatible Grafana version",
  "content": "Use plugin features"
}
```

## Complex Workflow Edge Cases

### Multi-Step Failures

#### Problem: Mid-Sequence Failures
**Cause**: One action in multistep fails, leaving partial state
**Solution**: Include requirements for each internal action

```json
{
  "type": "multistep",
  "requirements": ["on-page:/dashboard/new"],
  "content": "Add visualization, select data source, enter query",
  "steps": [
    {
      "action": "button",
      "reftarget": "Add visualization",
      "requirements": []
    },
    {
      "action": "button",
      "reftarget": "prometheus-datasource",
      "requirements": ["has-datasource:prometheus"]
    },
    {
      "action": "formfill",
      "reftarget": "textarea[data-testid='query-editor']",
      "targetvalue": "up",
      "requirements": []
    }
  ]
}
```

#### Problem: Section Execution Interruption
**Cause**: User cancels section execution or browser/tab closes
**Solution**: System provides resume functionality automatically

```json
// Section automatically resumes from last completed step
{
  "type": "section",
  "id": "long-workflow",
  "title": "Long Workflow",
  "tooltip": "Progress saved automatically - can resume if interrupted",
  "blocks": [
    // Steps will resume from where user left off
  ]
}
```

### State Synchronization Issues

#### Problem: External State Changes
**Cause**: User makes changes outside guide that affect requirements
**Solution**: Use live requirement monitoring and reactive checks

```json
// Requirements automatically recheck when DOM changes
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Edit panel",
  "requirements": ["on-page:/dashboard"],
  "tooltip": "Requirements automatically recheck if user navigates",
  "content": "Edit the panel"
}
```

#### Problem: Concurrent User Actions
**Cause**: User performs actions while guide is running
**Solution**: Use section blocking and cancellation

```json
// Section blocks other interactions during execution
{
  "type": "section",
  "id": "atomic-workflow",
  "title": "Atomic Workflow",
  "tooltip": "Blocks other interactions during execution for consistency",
  "blocks": [
    // Steps execute without interference
  ]
}
```

## Data Consistency Issues

### Data Source State Issues

#### Problem: Data Source Configuration Drift
**Cause**: Data source settings change after guide creation
**Solution**: Use type-based requirements instead of name-based

```json
// Bad: Relies on specific name
{
  "type": "interactive",
  "action": "button",
  "reftarget": "my-prometheus",
  "requirements": ["has-datasource:my-prometheus"],
  "content": "Select my prometheus data source"
}

// Good: Uses type for flexibility
{
  "type": "interactive",
  "action": "button",
  "reftarget": "prometheus",
  "requirements": ["has-datasource:type:prometheus"],
  "tooltip": "Works with any Prometheus data source",
  "content": "Select any Prometheus data source"
}
```

#### Problem: Missing Test Data
**Cause**: Guide assumes specific metrics/logs exist
**Solution**: Use generic queries that work with minimal data

```json
// Good: Uses universal Prometheus metric
{
  "type": "interactive",
  "action": "formfill",
  "reftarget": "textarea[data-testid='query-editor']",
  "targetvalue": "up",
  "requirements": ["has-datasource:prometheus"],
  "tooltip": "'up' metric exists on all Prometheus instances",
  "content": "Enter universal monitoring query"
}

// Avoid: Specific application metrics
{
  "type": "interactive",
  "action": "formfill",
  "reftarget": "textarea[data-testid='query-editor']",
  "targetvalue": "my_custom_app_requests_total",
  "tooltip": "Might not exist in all environments",
  "content": "Enter application-specific query"
}
```

## Accessibility and Usability Edge Cases

### Screen Reader Compatibility
```json
// Include helpful hints for screen readers
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "button[data-testid='save']",

  "tooltip": "Save button - preserves your dashboard configuration",
  "content": "Save your dashboard"
}

// Use ARIA attributes in selectors when available
{
  "type": "interactive",
  "action": "formfill",
  "reftarget": "input[aria-label='Dashboard title']",
  "targetvalue": "My Dashboard",

  "content": "Set dashboard title"
}
```

### Keyboard Navigation
```json
// Ensure interactive elements are keyboard accessible
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "button[data-testid='save'][tabindex='0']",

  "tooltip": "Accessible via keyboard navigation",
  "content": "Save dashboard (keyboard accessible)"
}
```

## Testing and Validation Edge Cases

### Automated Testing Considerations
```json
// Include test-friendly attributes
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Save dashboard",

  "tooltip": "Uses button text for reliable automated testing",
  "content": "Save dashboard"
}

// Alternative with test ID
{
  "type": "interactive",
  "action": "highlight",
  "reftarget": "button[data-testid='save-dashboard-btn']",

  "content": "Save dashboard using test ID"
}
```

### Load Testing Considerations
```json
// Handle high-latency environments
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Load dashboard",

  "tooltip": "May take longer in high-latency environments",
  "content": "Load dashboard (may take time)"
}

// Include verification for slow operations
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Save & test",

  "verify": "has-datasource:prometheus",
  "tooltip": "Verification confirms operation completed successfully",
  "content": "Save and test (with verification)"
}
```

## Debugging Tools and Techniques

### Browser Console Debugging
```javascript
// Check if selector works
document.querySelector("button[data-testid='save']");

// Test requirement checking
const testRequirement = async (req) => {
  const checker = await import('./requirements-checker.utils');
  const result = await checker.checkRequirements({
    requirements: req,
    targetAction: 'button',
    refTarget: 'test'
  });
  console.log(result);
};

// Test specific requirements
testRequirement('has-datasource:prometheus');
testRequirement('is-admin');

// Check current user state
console.log('User:', window.grafanaBootData?.user);
console.log('Features:', window.grafanaBootData?.settings?.featureToggles);
```

### Development Mode Features
```javascript
// Enable debug logging
localStorage.setItem('grafana-docs-debug', 'true');

// Check interactive element state
const manager = window.SequentialRequirementsManager?.getInstance();
if (manager) {
  manager.logCurrentState();
}

// Monitor requirement changes
document.addEventListener('interactive-action-completed', (e) => {
  console.log('Action completed:', e.detail);
});
```

### Common Debug Scenarios

#### "Requirements never pass"
1. Check browser console for error messages
2. Verify requirement syntax exactly matches reference
3. Test individual requirements in isolation
4. Check if required data/state actually exists

#### "Element not found"
1. Verify selector in browser console
2. Check if element exists in current page state
3. Ensure navigation requirements are met
4. Try alternative selectors

#### "Action doesn't execute"
1. Check if requirements are met
2. Verify element is clickable/interactable
3. Check browser console for JavaScript errors
4. Test action manually to verify it's possible

#### "Guide gets stuck"
1. Check for JavaScript errors in console
2. Verify network connectivity for API-dependent requirements
3. Clear localStorage to reset section progress
4. Check if user permissions changed

### Recovery Procedures

#### Reset Guide State
```javascript
// Clear all guide progress
Object.keys(localStorage)
  .filter(key => key.startsWith('docsPlugin:completedSteps:'))
  .forEach(key => localStorage.removeItem(key));

// Reload page to restart
window.location.reload();
```

#### Skip Problematic Steps
```json
// Make problematic steps skippable
{
  "type": "interactive",
  "action": "button",
  "reftarget": "Problematic action",
  "requirements": ["complex-requirement"],
  "skippable": true,
  "tooltip": "Skip if experiencing issues",
  "content": "Perform action (skippable if problems)"
}
```

#### Provide Manual Alternatives
```json
// Automated approach
{
  "type": "multistep",
  "skippable": true,
  "content": "Use automatic configuration",
  "steps": [
    {
      "action": "navigate",
      "reftarget": "/setup"
    },
    {
      "action": "button",
      "reftarget": "Auto configure"
    }
  ]
}

// Manual fallback
{
  "type": "interactive",
  "action": "navigate",
  "reftarget": "/manual-setup",
  "content": "Or configure manually step-by-step"
}
```
