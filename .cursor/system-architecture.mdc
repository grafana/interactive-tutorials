---
description: Architecture overview of the interactive guide system including content pipeline, block hierarchy, state management, and action execution.
---

# Interactive Guide System Architecture

## Overview

The interactive guide system is a React-based framework for creating guided, executable documentation within Grafana. It transforms structured **JSON guides** into interactive experiences with real Grafana UI manipulation.

> **Documentation**: See [docs/json-guide-format.md](../docs/json-guide-format.md) for the complete JSON format reference.

## Content Pipeline

```
JSON Guide File
    ↓
JSON Parser (json-parser.ts)
    ↓
Block Tree (typed JsonBlock[])
    ↓
Content Renderer (content-renderer.tsx)
    ↓
React Components
    ↓
Interactive UI with Grafana Integration
```

## Block Type Hierarchy

```
JsonBlock (union type)
├── Content Blocks
│   ├── markdown - Formatted text content
│   ├── image - Embedded images
│   └── video - YouTube/native video
│
├── Interactive Blocks
│   ├── interactive - Single action (highlight, button, formfill, navigate, hover)
│   ├── multistep - Automated multi-action sequence
│   └── guided - User-performed sequence with detection
│
├── Structural Blocks
│   ├── section - Grouped steps with "Do Section"
│   ├── conditional - Runtime condition branching
│   └── assistant - AI customization wrapper
│
└── Assessment Blocks
    ├── quiz - Knowledge check with choices
    └── input - Collect user response as variable
```

## Component Hierarchy

```
ContentRenderer
├── MarkdownBlock
├── ImageBlock
├── VideoBlock
├── InteractiveSection
│   ├── InteractiveStep
│   ├── InteractiveMultiStep
│   ├── InteractiveGuided
│   └── QuizBlock / InputBlock
├── ConditionalBlock
│   └── (renders whenTrue or whenFalse blocks)
└── AssistantBlock
    └── (wraps child blocks with AI customization)
```

## State Management

- **SequentialRequirementsManager**: Global singleton managing step eligibility
- **InteractiveStateManager**: Handles action execution state
- **Local Component State**: Individual step completion and UI state
- **Variable Storage**: Input block responses stored for `{{variable}}` substitution
- **Persistence**: Section completion stored in localStorage

## Action Execution System

### Action Handlers

| Handler           | Action Type  | Purpose                              |
|-------------------|--------------|--------------------------------------|
| `FocusHandler`    | `highlight`  | Click + visual feedback              |
| `ButtonHandler`   | `button`     | Text-based button finding            |
| `FormFillHandler` | `formfill`   | Complex form interaction             |
| `NavigateHandler` | `navigate`   | Internal/external navigation         |
| `HoverHandler`    | `hover`      | Trigger hover states                 |
| `GuidedHandler`   | `guided`     | User-performed action detection      |

### Execution Flow

1. **Pre-Check**: Verify requirements before execution
2. **Show Phase**: Highlight target element (if applicable)
3. **Do Phase**: Execute actual action
4. **Post-Verify**: Check post-conditions if specified (`verify` property)
5. **Completion**: Mark step complete, trigger dependent step checks

## Requirements System

### Checking Flow

1. **Objectives Check**: If objectives met → auto-complete step
2. **Step Eligibility**: SequentialRequirementsManager determines if step can execute
3. **Requirements Check**: Validate all requirements pass
4. **State Update**: Update step state and notify manager
5. **UI Update**: Render appropriate button states and messages

### Requirement Categories

- **DOM**: `exists-reftarget`, `navmenu-open`
- **Page**: `on-page:/path`
- **User**: `is-admin`, `is-editor`, `has-role:X`, `has-permission:X`
- **Data**: `has-datasources`, `has-datasource:X`, `has-plugin:X`
- **Flow**: `section-completed:id`, `var-name:value`
- **System**: `has-feature:X`, `min-version:X`, `in-environment:X`

## Key Design Patterns

### Hook-Based Architecture

- **useInteractiveElements**: Core hook for interactive functionality
- **useRequirementsChecker**: Individual step requirements validation
- **useStepChecker**: Unified requirements and objectives checking
- **useSequentialRequirements**: Global sequential step management

### Error Handling

- **Fail-Fast**: Invalid configurations cause immediate, clear errors
- **Graceful Degradation**: System continues when individual components fail
- **User-Friendly Messages**: Technical errors converted to actionable guidance
- **Recovery Options**: Automatic fixes (e.g., `navmenu-open` "Fix this" button)

## Integration Points

### Grafana Services

- **LocationService**: Internal navigation
- **DataSourceService**: Data source checking
- **Permission System**: User role validation
- **Theme System**: Visual styling adaptation

## Performance

- **Lazy Loading**: Requirements checked only when steps become eligible
- **Debounced Updates**: Rapid changes batched
- **Caching**: API results and DOM queries cached
- **Scalability**: Handles 50+ interactive steps efficiently

## Security

- **Safe Markdown**: No dynamic script execution in content
- **Action Validation**: All actions validated before execution
- **Permission Checking**: User permissions verified before privileged actions
- **State Isolation**: Guide execution doesn't interfere with user work
