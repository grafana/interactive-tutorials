{
  "schemaVersion": "1.0.0",
  "id": "mongodb-integration-prepare-configuration",
  "title": "Prepare MongoDB connection configuration",
  "blocks": [
    {
      "type": "markdown",
      "content": "In this milestone, you prepare the specific MongoDB connection details and security credentials. Proper MongoDB authentication and connection configuration ensures secure and reliable metrics collection.\n\nSetting up dedicated monitoring credentials with minimal required permissions follows security best practices and prevents potential access issues.\n\nConsider the following security guidelines:\n\n- Use environment variables or secret management systems for production deployments\n- Limit MongoDB user permissions to only what's required for monitoring\n- Enable SSL/TLS for MongoDB connections in production environments\n- Regularly rotate monitoring user credentials"
    },
    {
      "type": "markdown",
      "content": "To prepare your MongoDB connection configuration, complete the following steps:"
    },
    {
      "type": "markdown",
      "content": "Connect to your MongoDB instance and create a user with read-only permissions.\n\nThe following script creates a dedicated MongoDB user for monitoring.\n\n```javascript\nuse admin\ndb.createUser({\n  user: \"grafana_monitoring\",\n  pwd: \"secure_password_here\", \n  roles: [\n    { role: \"read\", db: \"admin\" },\n    { role: \"clusterMonitor\", db: \"admin\" },\n    { role: \"read\", db: \"local\" }\n  ]\n})\n```"
    },
    {
      "type": "markdown",
      "content": "Open the Grafana Alloy configuration file and replace the placeholders with your specific values.\n\nThis defines the MongoDB connection URI.\n\n```alloy\nmongodb_uri = \"mongodb://grafana_monitoring:secure_password_here@mongodb.example.com:27017/admin\"\n```\n\nFor MongoDB cloud deployments, include additional parameters:\n\n```alloy\nmongodb_uri = \"mongodb+srv://grafana_monitoring:secure_password_here@cluster.example.mongodb.net/admin?retryWrites=true\"\n```"
    },
    {
      "type": "markdown",
      "content": "Configure the service and cluster labels by updating the label values in the Grafana Alloy configuration file.\n\n```alloy\nrule {\n    target_label = \"service_name\"\n    replacement  = \"mongodb-production\"\n}\n\nrule {\n    target_label = \"mongodb_cluster\"  \n    replacement  = \"main-cluster\"\n}\n\nrule {\n    target_label = \"instance\"\n    replacement  = \"mongodb-prod-01\"\n}\n```\n\nIn your next milestone, you'll test the connection and verify metrics collection."
    },
    {
      "type": "markdown",
      "content": "## More to explore (optional)\n\nAt this point in your journey, you can explore the following paths:\n\n- [MongoDB connection string format](/docs/grafana-cloud/send-data/metrics/)"
    }
  ]
}
