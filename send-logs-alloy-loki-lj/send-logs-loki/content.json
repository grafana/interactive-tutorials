{
  "schemaVersion": "1.0.0",
  "id": "send-logs-alloy-loki-send-logs-loki",
  "title": "Send logs to Grafana Loki",
  "blocks": [
    {
      "type": "markdown",
      "content": "The `config.alloy` file defines the pipeline for how Alloy should receive telemetry data, process or transform it, and export it to Prometheus, Loki, Tempo, or other platforms and databases.\n\nThe default configuration file location for Alloy is:\n\n- Linux: `/etc/alloy/config.alloy`\n- macOS: `$(brew --prefix)/etc/alloy/config.alloy`\n- Windows: `%ProgramFiles%\\GrafanaLabs\\Alloy\\config.alloy`\n\nYou can open the configuration file using `vim` or `nano`. For this example, [VSCode](https://code.visualstudio.com/) is used with the [Alloy plugin](https://marketplace.visualstudio.com/items?itemName=Grafana.grafana-alloy) installed, as it comes with the advantage of syntax support.\n\n```bash\ncode $(brew --prefix)/etc/alloy/config.alloy\n```\n\nWhen you open the configuration file automatically generated by the setup guide in Grafana Cloud, a working pipeline is already set up by default that:\n\n1. Collects and exposes internal metrics about Alloy itself\n2. Adds useful labels to the metrics that will be scraped\n3. Starts a Prometheus scraping job that will scrape the internal metrics with a 60-second interval\n4. Filters the metrics to keep the useful ones\n5. Forwards them to Grafana Cloud Prometheus\n6. Forwards logs to Grafana Cloud Logs (Loki), but it's not wired up yet.\n\nWith the configuration file still open, add the following components:"
    },
    {
      "type": "markdown",
      "content": "To configure Alloy to search for log files to source, copy and paste the following component configuration before the [`loki.write`](/docs/alloy/latest/reference/components/loki/loki.write/) component.\n\nWhile not required, the recommended order of components provides for better organization and readability.\n\n```alloy\nlocal.file_match \"local_files\" {\n    path_targets = [{\"__path__\" = \"/var/log/*.log\"}]\n    sync_period = \"5s\"\n}\n```\n\nThis configuration creates a [`local.file_match`](/docs/alloy/latest/reference/components/local/local.file_match/) component named `local_files` which does the following:\n\n- It tells Alloy which files to source.\n- It checks for new files every 5 seconds."
    },
    {
      "type": "markdown",
      "content": "To configure Alloy to read log entries from files and forward them to other `loki.*` components, copy and paste the following component configuration after the `local.file_match` component.\n\n```alloy\n  loki.source.file \"log_scrape\" {\n    targets    = local.file_match.local_files.targets\n    forward_to = [loki.write.grafana_cloud_loki.receiver]\n  }\n```\n\nThis configuration creates a [`loki.source.file`](/docs/alloy/latest/reference/components/loki/loki.source.file/) component named `log_scrape` which does the following:\n\n- It connects to the `local_files` component as its source or target.\n- It forwards the logs it scrapes to the `loki.write` component called `grafana_cloud_loki`."
    },
    {
      "type": "markdown",
      "content": "Run the following command to call the `/-/reload` endpoint to tell Alloy to reload the configuration file without a system service restart.\n\n```bash\ncurl -X POST http://localhost:12345/-/reload\n```\n\nYou should see the message `config reloaded` printed on your terminal.\n\n> **Note:** Run the reload command whenever you make changes to the configuration.\n\nIn the next milestone, you're going to inspect your configuration file in the Alloy UI."
    }
  ]
}
