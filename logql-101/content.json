{
  "id": "logql-101",
  "title": "LogQL 101 - Interactive Guide (JSON)",
  "blocks": [
    {
      "type": "markdown",
      "content": "Welcome to LogQL 101.\n\nIn this guide you will learn how to:\n\n- Select a Loki data source in Explore\n- Write basic LogQL queries using label selectors\n- Refine results with line filters and JSON parsing\n- Make results easier to scan with formatting\n- Avoid common pitfalls when converting logs to metrics"
    },
    {
      "type": "markdown",
      "content": "## Section 1: Write your first LogQL query ‚úçÔ∏è\n\nWhat you will learn in this section:\n\n- Select the data source used by this guide\n- Set the time range intentionally for your queries\n- Write a label selector, run a query, and view results"
    },
    {
      "type": "section",
      "id": "write-first-logql-query",
      "title": "Write your first LogQL query",
      "requirements": ["on-page:/explore", "has-datasource:loki"],
      "blocks": [
        {
          "type": "multistep",
          "tooltip": "Select the data source used by this guide.",
          "content": "Select **LokiNGINXLogs** in the Data source menu. This datasource contains logs from an Nginx web server and we'll be using it for the rest of this tutorial.",
          "steps": [
            {
              "action": "highlight",
              "reftarget": "input[data-testid=\"data-testid Select a data source\"]"
            },
            {
              "action": "button",
              "reftarget": "LokiNGINXLogs"
            }
          ]
        }
        ,
        {
          "type": "multistep",
          "tooltip": "Log results are always scoped to the selected time range. Pick a range intentionally so you know what time window your query is searching.",
          "content": "Open the time range menu (clock icon), then select **Last 24 hours**.",
          "steps": [
            {
              "action": "highlight",
              "reftarget": "button[data-testid=\"data-testid TimePicker Open Button\"]"
            },
            {
              "action": "highlight",
              "reftarget": "#TimePickerContent label:contains(\"Last 24 hours\")"
            }
          ]
        },
        {
          "type": "interactive",
          "action": "highlight",
          "reftarget": "div[data-testid=\"QueryEditorModeToggle\"] input[id^=\"option-code-radiogroup\"]",
          "requirements": ["on-page:/explore", "exists-reftarget"],
          "tooltip": "Use Code mode to type LogQL directly.",
          "content": "There are two modes to write LogQL queries: Builder and Code. Use Code mode to type LogQL directly."
        },
        {
          "type": "multistep",
          "tooltip": "Run the query to see matching log lines.",
          "content": "In Loki, the most basic query is a label selector. You can read more about labels [here](https://grafana.com/docs/loki/latest/get-started/labels/). For now, type a label selector query:\n\n`{service_name=\"nginx_access_log\"}`",
          "steps": [
            {
              "action": "highlight",
              "reftarget": "textarea.inputarea"
            },
            {
              "action": "formfill",
              "reftarget": "textarea.inputarea",
              "targetvalue": "{service_name=\"nginx_access_log\"}"
            }
          ]
        },
        {
          "type": "markdown",
          "content": "This query means, \"Show me all logs within this time range that have the service name `nginx_access_log`.\""
        },
        {
          "type": "interactive",
          "action": "highlight",
          "reftarget": "button[data-testid=\"data-testid RefreshPicker run button\"]",
          "requirements": ["on-page:/explore", "exists-reftarget"],
          "tooltip": "This runs your query using the current time range and data source selection.",
          "content": "Click **Run query** to execute the query and view the results."
        },
        {
          "type": "interactive",
          "action": "highlight",
          "reftarget": "div[data-testid=\"data-testid panel content\"]:has(span.field.log-syntax-highlight.log-line-body)",
          "requirements": ["on-page:/explore", "exists-reftarget"],
          "doIt": false,
          "tooltip": "This area shows the results for your last query.",
          "content": "Notice the results area. These are results Loki found that match your query."
        },
        {
          "type": "markdown",
          "content": "There's a lot going on here, and it can be difficult to look through the raw log line to find what you're looking for. Let's break it down."
        },
        {
          "type": "multistep",
          "tooltip": "Click on a log line to see its details and labels.",
          "content": "Click on the first log line to expand it and view its details.",
          "steps": [
            {
              "action": "highlight",
              "reftarget": "div[data-testid=\"logRows\"] div[style*=\"top: 0px\"] span.field.log-syntax-highlight.log-line-body"
            }
          ]
        },
        {
          "type": "interactive",
          "action": "highlight",
          "reftarget": "div.log-line-inline-details div[class*=\"collapse__header-label\"]:contains(\"Log line\")",
          "requirements": ["on-page:/explore", "exists-reftarget"],
          "doIt": false,
          "tooltip": "This shows the original log line as it was ingested.",
          "content": "This is the **Log line** section. Here you can see the original log line exactly as it was ingested into Loki."
        },
        {
          "type": "interactive",
          "action": "highlight",
          "reftarget": "div.log-line-inline-details div[class*=\"collapse__header-label\"]:contains(\"Indexed label\")",
          "requirements": ["on-page:/explore", "exists-reftarget"],
          "doIt": false,
          "tooltip": "Indexed labels are key-value pairs attached to log streams.",
          "content": "This is the **Indexed labels** section. These are indexed metadata used for filtering logs in your queries. You can read more about how to add labels [here](https://grafana.com/docs/loki/latest/get-started/labels/#loki-labels-examples)."
        },
        {
          "type": "interactive",
          "action": "highlight",
          "reftarget": "div.log-line-inline-details div[class*=\"collapse__header-label\"]:contains(\"Structured\")",
          "requirements": ["on-page:/explore", "exists-reftarget"],
          "doIt": false,
          "tooltip": "Structured metadata provides additional context without affecting stream identity.",
          "content": "This is the **Structured metadata** section. This contains additional fields that aren't part of the log stream's identity. You can read more about structured metadata [here](https://grafana.com/docs/loki/latest/get-started/labels/structured-metadata/)."
        },
        {
          "type": "markdown",
          "content": "Using the log details panel helps you read the log line and understand the context of the log entry. But you might still be daunted by the sheer volume of results. By default, Loki returns 1000 results. That can be a lot of data to look through if you're looking for something specific."
        }
      ]
    },
    {
      "type": "markdown",
      "content": "### What you have learned\n\n- How to select a Loki data source\n- How to change the time range used for queries\n- How to start with a label selector\n- How to run a query and view results"
    },
    {
      "type": "markdown",
      "content": "## Section 2: Refine results with line filters üîé"
    },
    {
      "type": "markdown",
      "content": "By default, Loki returns 1000 results. That can be a lot of data to look through if you're looking for something specific."
    },
    {
      "type": "markdown",
      "content": "What you will learn in this section:\n\n- How to narrow results using line filters\n- Why line filters can match more than you expect"
    },
    {
      "type": "section",
      "id": "line-filters",
      "title": "Refine results with line filters",
      "requirements": ["on-page:/explore", "has-datasource:loki"],
      "blocks": [
        {
          "type": "multistep",
          "tooltip": "Line filters match text anywhere in each log line.",
          "content": "Add a label and a simple line filter, then run the query:\n\n`{service_name=\"nginx_access_log\", host=\"appfelstrudel\"} |= \"500\"`",
          "steps": [
            {
              "action": "highlight",
              "reftarget": "textarea.inputarea"
            },
            {
              "action": "formfill",
              "reftarget": "textarea.inputarea",
              "targetvalue": "{service_name=\"nginx_access_log\", host=\"appfelstrudel\"} |= \"500\""
            },
            {
              "action": "highlight",
              "reftarget": "button[data-testid=\"data-testid RefreshPicker run button\"]"
            }
          ]
        },
        {
          "type": "markdown",
          "content": "If this feels noisy: `|= \"500\"` matches any log line containing that text, not ‚ÄúHTTP status is 500‚Äù. Next we‚Äôll make it more precise."
        },
        {
          "type": "multistep",
          "tooltip": "Combining include and exclude filters can reduce noise.",
          "content": "Exclude a common success code, then run the query:\n\n`{service_name=\"nginx_access_log\", host=\"appfelstrudel\"} |= \"500\" != \"200\"`",
          "steps": [
            {
              "action": "highlight",
              "reftarget": "textarea.inputarea"
            },
            {
              "action": "formfill",
              "reftarget": "textarea.inputarea",
              "targetvalue": "{service_name=\"nginx_access_log\", host=\"appfelstrudel\"} |= \"500\" != \"200\""
            },
            {
              "action": "highlight",
              "reftarget": "button[data-testid=\"data-testid RefreshPicker run button\"]"
            }
          ]
        }
      ]
    },
    {
      "type": "markdown",
      "content": "### What you have learned\n\n- How to use line filters to narrow results\n- Why line filters can match more than you expect"
    },
    {
      "type": "markdown",
      "content": "## Section 3: Parse JSON for precise filtering üß©\n\nWhat you will learn in this section:\n\n- How to parse JSON logs\n- How to filter by a specific field"
    },
    {
      "type": "section",
      "id": "json-query",
      "title": "Parse JSON for precise filtering",
      "requirements": ["on-page:/explore", "has-datasource:loki"],
      "blocks": [
        {
          "type": "multistep",
          "tooltip": "Parsing structured logs lets you filter by fields instead of raw text.",
          "content": "Parse JSON and filter by the `status` field, then run the query:\n\n`{service_name=\"nginx_access_log\", host=\"appfelstrudel\"} | json | status = \"500\"`",
          "steps": [
            {
              "action": "highlight",
              "reftarget": "textarea.inputarea"
            },
            {
              "action": "formfill",
              "reftarget": "textarea.inputarea",
              "targetvalue": "{service_name=\"nginx_access_log\", host=\"appfelstrudel\"} | json | status = \"500\""
            },
            {
              "action": "highlight",
              "reftarget": "button[data-testid=\"data-testid RefreshPicker run button\"]"
            }
          ]
        }
      ]
    },
    {
      "type": "markdown",
      "content": "### What you have learned\n\n- How to parse JSON logs\n- How to filter by a specific field"
    },
    {
      "type": "markdown",
      "content": "## Section 4: Format output with line_format üßπ\n\nWhat you will learn in this section:\n\n- How to format each log line for easier scanning"
    },
    {
      "type": "section",
      "id": "line-format",
      "title": "Format output with line_format",
      "requirements": ["on-page:/explore", "has-datasource:loki"],
      "blocks": [
        {
          "type": "multistep",
          "tooltip": "Formatting changes how results display without changing which lines match.",
          "content": "Add `line_format` and run the query:\n\n`{service_name=\"nginx_access_log\", host=\"appfelstrudel\"} | json | status = \"500\" | line_format \"{{.status}} {{.request_uri}}\"`",
          "steps": [
            {
              "action": "highlight",
              "reftarget": "textarea.inputarea"
            },
            {
              "action": "formfill",
              "reftarget": "textarea.inputarea",
              "targetvalue": "{service_name=\"nginx_access_log\", host=\"appfelstrudel\"} | json | status = \"500\" | line_format \"{{.status}} {{.request_uri}}\""
            },
            {
              "action": "highlight",
              "reftarget": "button[data-testid=\"data-testid RefreshPicker run button\"]"
            }
          ]
        }
      ]
    },
    {
      "type": "markdown",
      "content": "### What you have learned\n\n- How to format each log line for easier scanning"
    },
    {
      "type": "markdown",
      "content": "## Section 5: Use regex carefully üßµ\n\nWhat you will learn in this section:\n\n- How to apply regex to a specific parsed field\n- When to avoid regex"
    },
    {
      "type": "section",
      "id": "regex-last-resort",
      "title": "Use regex carefully",
      "requirements": ["on-page:/explore", "has-datasource:loki"],
      "blocks": [
        {
          "type": "multistep",
          "tooltip": "Regex on a specific field is more precise than regex on the full line.",
          "content": "Match only URIs that include an ID segment, then run the query:\n\n`{service_name=\"nginx_access_log\", host=\"appfelstrudel\"} | json | status = \"500\" | request_uri =~ \".*/id/[0-9]+.*\" | line_format \"{{.status}} {{.request_uri}}\"`",
          "steps": [
            {
              "action": "highlight",
              "reftarget": "textarea.inputarea"
            },
            {
              "action": "formfill",
              "reftarget": "textarea.inputarea",
              "targetvalue": "{service_name=\"nginx_access_log\", host=\"appfelstrudel\"} | json | status = \"500\" | request_uri =~ \".*/id/[0-9]+.*\" | line_format \"{{.status}} {{.request_uri}}\""
            },
            {
              "action": "highlight",
              "reftarget": "button[data-testid=\"data-testid RefreshPicker run button\"]"
            }
          ]
        },
        {
          "type": "markdown",
          "content": "Tip: `!~` is the exclude form. For example: `| request_uri !~ \"/admin\"`."
        }
      ]
    },
    {
      "type": "markdown",
      "content": "### What you have learned\n\n- How to apply regex to a specific parsed field\n- Why regex should be a last resort"
    },
    {
      "type": "markdown",
      "content": "## Section 6: Turn logs into a chart üìà\n\nWhat you will learn in this section:\n\n- How to count matching log lines over time\n- How to avoid common series limit errors"
    },
    {
      "type": "section",
      "id": "metrics-teaser",
      "title": "Turn logs into a chart",
      "requirements": ["on-page:/explore", "has-datasource:loki"],
      "blocks": [
        {
          "type": "multistep",
          "tooltip": "This turns a log query into a time series by counting matches over time.",
          "content": "Count HTTP 500s over time, then run the query:\n\n`count_over_time({service_name=\"nginx_access_log\", host=\"appfelstrudel\"} | json | status = \"500\"[1h])`",
          "steps": [
            {
              "action": "highlight",
              "reftarget": "textarea.inputarea"
            },
            {
              "action": "formfill",
              "reftarget": "textarea.inputarea",
              "targetvalue": "count_over_time({service_name=\"nginx_access_log\", host=\"appfelstrudel\"} | json | status = \"500\"[1h])"
            },
            {
              "action": "highlight",
              "reftarget": "button[data-testid=\"data-testid RefreshPicker run button\"]"
            }
          ]
        },
        {
          "type": "markdown",
          "content": "If you hit a series limit error, it‚Äôs usually because parsing creates many unique series. To fix it, aggregate everything into a single series with `sum()`."
        },
        {
          "type": "multistep",
          "tooltip": "Aggregating reduces series count by combining many series into one.",
          "content": "Wrap the query with `sum()` and run it:\n\n`sum(count_over_time({service_name=\"nginx_access_log\", host=\"appfelstrudel\"} | json | status = \"500\"[1h]))`",
          "steps": [
            {
              "action": "highlight",
              "reftarget": "textarea.inputarea"
            },
            {
              "action": "formfill",
              "reftarget": "textarea.inputarea",
              "targetvalue": "sum(count_over_time({service_name=\"nginx_access_log\", host=\"appfelstrudel\"} | json | status = \"500\"[1h]))"
            },
            {
              "action": "highlight",
              "reftarget": "button[data-testid=\"data-testid RefreshPicker run button\"]"
            }
          ]
        }
      ]
    },
    {
      "type": "markdown",
      "content": "### What you have learned\n\n- How to count log matches over time\n- How to reduce series cardinality with aggregation"
    },
    {
      "type": "markdown",
      "content": "## Wrap up\n\nA practical LogQL workflow is:\n\n- Start with labels to narrow the search\n- Add line filters to refine\n- Prefer parsing for precision\n- Format results to scan quickly\n- Use regex only when you can‚Äôt parse\n- Aggregate when turning logs into metrics"
    }
  ]
}

